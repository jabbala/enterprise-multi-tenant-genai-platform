# Enterprise Multi-Tenant GenAI Platform - Production Configuration
# =====================================================================
# This is a TEMPLATE for production deployments
# Use with caution - some values are placeholders and must be set via:
# 1. Environment variables during container startup
# 2. Kubernetes Secrets mounted as env files
# 3. AWS Secrets Manager / Azure Key Vault / HashiCorp Vault integration

# ======================================================================
# APPLICATION SETTINGS
# ======================================================================
APP_ENV=production
APP_NAME=Enterprise Multi-Tenant GenAI Platform
API_VERSION=v1
HOST=0.0.0.0
PORT=8000
WORKERS=8
DEBUG=false

# ======================================================================
# DATABASE CONFIGURATION
# ======================================================================
# CRITICAL: Set DATABASE_URL via Kubernetes Secret or environment
# Format: postgresql://user:password@host:port/database?sslmode=require
DATABASE_URL=${DB_CONNECTION_STRING}
DATABASE_POOL_SIZE=50
DATABASE_POOL_RECYCLE=1800
DATABASE_ECHO=false
DATABASE_DISABLE_WARNINGS=false

# ======================================================================
# REDIS CONFIGURATION
# ======================================================================
# For production, use managed Redis (AWS ElastiCache, Azure Cache, etc.)
REDIS_URL=${REDIS_CONNECTION_STRING}
REDIS_CLUSTER_ENABLED=true
REDIS_KEY_PREFIX=genai:prod:
REDIS_SOCKET_TIMEOUT=10
REDIS_RETRY_ON_TIMEOUT=true

# ======================================================================
# OPENSEARCH CONFIGURATION
# ======================================================================
# Production OpenSearch cluster with TLS and authentication
OPENSEARCH_HOSTS=${OPENSEARCH_ENDPOINTS}
OPENSEARCH_USER=${OPENSEARCH_USERNAME}
OPENSEARCH_PASSWORD=${OPENSEARCH_PASSWORD}
OPENSEARCH_VERIFY_CERTS=true
OPENSEARCH_CA_CERT_PATH=/etc/ssl/certs/opensearch-ca.crt
OPENSEARCH_SCHEME=https
OPENSEARCH_INDEX_PREFIX=genai_prod_
OPENSEARCH_SHARDS=5
OPENSEARCH_REPLICAS=2

# ======================================================================
# FAISS VECTOR STORE CONFIGURATION
# ======================================================================
# For production, use shared storage (EBS, GCS, AzureBlob)
FAISS_INDEX_PATH=/mnt/shared/faiss_indices
FAISS_DIMENSION=1536
FAISS_INDEX_TYPE=IVF256,Flat
FAISS_NPROBE=16

# ======================================================================
# LLM CONFIGURATION
# ======================================================================
LLM_PROVIDER=openai
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_ORG_ID=${OPENAI_ORG_ID}
OPENAI_MODEL_PRIMARY=gpt-4-turbo
OPENAI_MODEL_SECONDARY=gpt-4
OPENAI_MODEL_FALLBACK=gpt-3.5-turbo
LLM_REQUEST_TIMEOUT=45
LLM_MAX_RETRIES=3
LLM_RETRY_BACKOFF_FACTOR=2.0

# ======================================================================
# EMBEDDING CONFIGURATION
# ======================================================================
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSION=1536
EMBEDDING_BATCH_SIZE=200
EMBEDDING_MAX_TOKENS=8191

# ======================================================================
# SECURITY & AUTHENTICATION
# ======================================================================
# CRITICAL: JWT_SECRET_KEY must be at least 32 characters and unique
# Use cryptographically secure random: openssl rand -base64 32
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24
JWT_ISSUER=genai-platform-prod
JWT_AUDIENCE=genai-users

# Encryption configuration (envelope encryption at rest)
ENCRYPTION_ENABLED=true
ENCRYPTION_ALGORITHM=AES-256-GCM
KMS_PROVIDER=aws-kms
KMS_KEY_ID=${AWS_KMS_KEY_ID}
AWS_KMS_REGION=us-east-1
AWS_KMS_KEY_ARN=${AWS_KMS_KEY_ARN}
KEY_ROTATION_ENABLED=true
KEY_ROTATION_INTERVAL_DAYS=365

# ======================================================================
# RATE LIMITING & BACKPRESSURE
# ======================================================================
# Production limits (adjust based on infrastructure capacity)
DEFAULT_QPS_LIMIT=20
DEFAULT_BURST_QPS=50
DEFAULT_BURST_DURATION_SEC=10
DEFAULT_DAILY_QUOTA=500000

# Queue configuration
MAX_QUEUE_DEPTH=500
QUEUE_TIMEOUT_SEC=45
MAX_INFLIGHT_PER_POD=100
WORKER_POOL_SIZE=20
QUEUE_CHECK_INTERVAL_MS=50
QUEUE_MONITORING_INTERVAL_SEC=5

# ======================================================================
# FAIR SHARING & TENANT TIER CONFIGURATION
# ======================================================================
# Production fair share allocations
FAIR_SHARE_ENTERPRISE=0.50
FAIR_SHARE_PROFESSIONAL=0.30
FAIR_SHARE_STARTER=0.15
FAIR_SHARE_FREE=0.05

# Noisy neighbor detection
NOISY_NEIGHBOR_THRESHOLD=0.20
NOISY_NEIGHBOR_ALERT_THRESHOLD=0.25
NOISY_NEIGHBOR_CHECK_INTERVAL_SEC=30

# ======================================================================
# DATA GOVERNANCE & RETENTION
# ======================================================================
DEFAULT_RETENTION_DAYS=365
DEFAULT_DATA_RESIDENCY=us
PII_REDACTION_ENABLED=true
PII_REDACTION_PATTERNS=email,phone,ssn,credit_card,ipv4

# ======================================================================
# MODEL EVALUATION & GOVERNANCE
# ======================================================================
EVALUATION_DATASET_PATH=/mnt/shared/evaluation_datasets
MODEL_REGRESSION_THRESHOLD_PCT=2.0
MODEL_A_B_TEST_STAGES=[0.01, 0.05, 0.10, 0.50, 1.0]
MODEL_AB_TEST_MIN_SAMPLES=500
MODEL_EVAL_METRICS=success_rate,latency_p95,cost_per_query,injection_blocked

# ======================================================================
# OBSERVABILITY & MONITORING
# ======================================================================
# Prometheus metrics for production monitoring
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=8001
PROMETHEUS_SCRAPE_INTERVAL_SEC=15

# OpenTelemetry tracing for distributed tracing
OTEL_ENABLED=true
OTEL_JAEGER_ENABLED=true
OTEL_JAEGER_HOST=${JAEGER_COLLECTOR_HOST}
OTEL_JAEGER_PORT=6831
OTEL_TRACE_SAMPLE_RATE=0.1

# Logging configuration
LOGGING_LEVEL=WARNING
STRUCTURED_LOGGING_ENABLED=true
LOG_FORMAT=json

# ======================================================================
# COST TRACKING & BILLING
# ======================================================================
COST_TRACKING_ENABLED=true
LLM_COST_PER_1K_TOKENS=0.03
RETRIEVAL_COST_PER_QUERY=0.001
COMPUTE_COST_PER_SECOND=0.001
COST_RECONCILIATION_INTERVAL_HOURS=1
COST_VARIANCE_ALERT_THRESHOLD_PCT=5

# ======================================================================
# HEALTH CHECK & LIVENESS
# ======================================================================
HEALTH_CHECK_INTERVAL_SEC=10
LIVENESS_PROBE_ENABLED=true
READINESS_PROBE_ENABLED=true
STARTUP_PROBE_INITIAL_DELAY_SEC=30

# All checks enabled in production
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_OPENSEARCH=true
HEALTH_CHECK_LLM_PROVIDER=true

# ======================================================================
# INSIDER THREAT DETECTION
# ======================================================================
THREAT_DETECTION_ENABLED=true
THREAT_DETECTION_SERVICE=behavioral_analytics

# Production threat detection settings
BEHAVIOR_BASELINE_WINDOW_DAYS=60
BEHAVIOR_BASELINE_MIN_SAMPLES=500
BEHAVIOR_ANOMALY_SCORE_THRESHOLD=75.0

# Query scraping detection (tight in production)
QUERY_SCRAPING_WINDOW=5
QUERY_SCRAPING_SIMILARITY_THRESHOLD=0.95
QUERY_SCRAPING_ALERT_THRESHOLD=3

# Mass export detection
MASS_EXPORT_THRESHOLD=500
MASS_EXPORT_TIME_WINDOW_MINUTES=30
MASS_EXPORT_ALERT_THRESHOLD=5

# Privilege escalation detection
PRIVILEGE_ESCALATION_MONITOR_ENABLED=true
PRIVILEGE_ESCALATION_ALERT_THRESHOLD=1

# ======================================================================
# RETRIEVAL CONFIGURATION
# ======================================================================
RETRIEVAL_TOP_K=10
RETRIEVAL_MIN_SCORE=0.5
RETRIEVAL_TIME_LIMIT_SEC=8
BM25_WEIGHT=0.35
VECTOR_WEIGHT=0.65
RERANKER_ENABLED=true

# ======================================================================
# RAG PIPELINE CONFIGURATION
# ======================================================================
RAG_MAX_TOKENS=4000
RAG_CONTEXT_WINDOW_TOKENS=2500
RAG_MIN_RETRIEVAL_SCORE=0.3
RAG_MAX_DOCUMENTS=15
RAG_TIMEOUT_SEC=60

# ======================================================================
# DEPLOYMENT CONFIGURATION
# ======================================================================
# Set automatically by Kubernetes downward API
POD_NAME=${HOSTNAME}
POD_NAMESPACE=genai-prod
CLUSTER_NAME=production-us-east-1

# Feature flags for production
FEATURE_FLAG_VECTOR_SEARCH=true
FEATURE_FLAG_ENSEMBLE_RETRIEVAL=true
FEATURE_FLAG_ASYNC_COST_SYNC=true
FEATURE_FLAG_MODEL_AB_TESTING=true

# ======================================================================
# ADVANCED SETTINGS
# ======================================================================
# Connection pool tuning
CONNECTION_POOL_MAX_OVERFLOW=20
CONNECTION_POOL_TIMEOUT_SEC=15

# Circuit breaker for resilience
CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SEC=120

# Request tracking headers
REQUEST_ID_HEADER=X-Request-ID
CORRELATION_ID_HEADER=X-Correlation-ID
TRACE_ID_HEADER=X-Trace-ID

# ======================================================================
# ALARMS & ALERTING THRESHOLDS
# ======================================================================
# CPU/Memory thresholds for scaling triggers
CPU_SCALE_UP_THRESHOLD_PCT=75
CPU_SCALE_DOWN_THRESHOLD_PCT=25
MEMORY_SCALE_UP_THRESHOLD_PCT=80
MEMORY_SCALE_DOWN_THRESHOLD_PCT=30

# Error rate alerting
ERROR_RATE_ALERT_THRESHOLD_PCT=5
ERROR_SPIKE_DETECTION_ENABLED=true

# Latency alerting
P99_LATENCY_ALERT_THRESHOLD_MS=5000
P95_LATENCY_ALERT_THRESHOLD_MS=3000

# Cost overage alerting
MONTHLY_COST_ALERT_THRESHOLD_USD=10000
DAILY_COST_ALERT_THRESHOLD_USD=500
